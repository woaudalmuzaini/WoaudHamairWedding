<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Wedding Website | Woaud & Hamair</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Playfair+Display:wght@500;600;700;800&display=swap" rel="stylesheet">

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Chart -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>

  <!-- Excel -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            blush: {
              50:"#fff1f6",100:"#ffe4ee",200:"#ffc7dc",300:"#ff9fc3",400:"#ff6da5",500:"#ff3d87"
            }
          }
        }
      }
    }
  </script>

  <style>
    body{
      font-family:"Cormorant Garamond",serif;
      background:linear-gradient(180deg,#fff,#fff1f6);
      color:#2a1f29;
    }
    .panel{
      background:rgba(255,255,255,.85);
      border-radius:20px;
      border:1px solid rgba(255,61,135,.2);
      padding:1.5rem;
    }
    .btn{
      border-radius:999px;
      padding:.7rem 1.2rem;
      font-weight:700;
    }
    .btn-primary{background:#ff3d87;color:#fff;}
    .btn-secondary{border:1px solid #ff3d87;color:#ff3d87;}
    .btn-danger{background:#e11d48;color:#fff;}
    input,select,textarea{
      width:100%;
      padding:.7rem 1rem;
      border-radius:14px;
      border:1px solid rgba(255,61,135,.3);
    }
  </style>
</head>

<body>
<div id="root"></div>

<script>
(() => {
const e = React.createElement;

/* ---------------- DATA ---------------- */
const WEDDING = {
  couple:"Woaud & Hamair",
  dateISO:"2026-01-15T20:00:00+04:00",
  dateLabel:"15 January 2026",
  timeLabel:"8:00 PM",
  location:"Alnuman Palace Hall / Barka"
};

const DB="WeddingDB";
const STORE="rsvps";

/* ---------------- DB ---------------- */
function openDB(){
  return new Promise(res=>{
    const r=indexedDB.open(DB,1);
    r.onupgradeneeded=()=>r.result.createObjectStore(STORE,{keyPath:"id"});
    r.onsuccess=()=>res(r.result);
  });
}
async function getAll(){
  const db=await openDB();
  return new Promise(res=>{
    const tx=db.transaction(STORE);
    tx.objectStore(STORE).getAll().onsuccess=e=>res(e.target.result||[]);
  });
}
async function put(item){
  const db=await openDB();
  db.transaction(STORE,"readwrite").objectStore(STORE).put(item);
}

/* ---------------- APP ---------------- */
function App(){
  const [tab,setTab]=React.useState("home");
  const [items,setItems]=React.useState([]);
  const [form,setForm]=React.useState({name:"",song:"",status:"unknown"});

  React.useEffect(()=>{ getAll().then(setItems); },[]);

  const filtered = items.filter(x => true); // ✅ FIXED (no crash)

  async function quickSave(){
    if(!form.name.trim()){ alert("Name required"); return; }
    const item={
      id:Date.now().toString(),
      name:form.name,
      song:form.song,
      status:"unknown",
      createdAt:Date.now()
    };
    await put(item);
    setItems([item,...items]);
    setForm({name:"",song:"",status:"unknown"});
    setTab("dashboard");
  }

  return e("div",{className:"max-w-5xl mx-auto p-4 space-y-8"},[
    e("h1",{className:"text-5xl font-bold text-center"},WEDDING.couple),

    tab==="home" && e("div",{className:"panel space-y-4"},[
      e("p",{className:"text-center"},`${WEDDING.dateLabel} · ${WEDDING.timeLabel}`),
      e("input",{placeholder:"Your name",value:form.name,onChange:e=>setForm({...form,name:e.target.value})}),
      e("input",{placeholder:"Song request",value:form.song,onChange:e=>setForm({...form,song:e.target.value})}),
      e("button",{className:"btn btn-primary w-full",onClick:quickSave},"Submit RSVP + Song")
    ]),

    tab==="dashboard" && e("div",{className:"panel space-y-4"},[
      e("h2",{className:"text-2xl font-bold"},"RSVP Dashboard"),
      filtered.length===0 && e("p",null,"No RSVPs yet"),
      filtered.map(r=>e("div",{key:r.id,className:"border-b pb-2"},`${r.name} — ${r.song||"No song"}`)),
      e("button",{className:"btn btn-secondary",onClick:()=>setTab("home")},"Back")
    ])
  ]);
}

ReactDOM.createRoot(document.getElementById("root")).render(e(App));
})();
</script>
</body>
</html>
